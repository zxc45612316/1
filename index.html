
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>模擬台股交易 升級版</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .stock, .wallet, .history { background: #fff; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .stock-list { margin-top: 20px; }
    .stock-item { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
    button { padding: 5px 10px; margin-left: 5px; }
    input { width: 60px; text-align: center; }
    table { width: 100%; margin-top: 10px; border-collapse: collapse; }
    th, td { padding: 8px; border-bottom: 1px solid #ddd; text-align: center; }
    .search-bar { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>模擬台股交易 升級版</h1>

  <div class="wallet">
    <h2>資金餘額：<span id="cash">100000</span> 元</h2>
  </div>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="搜尋股票代號或名稱" oninput="searchStock()" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;">
  </div>

  <div class="stock-list" id="stock-list"></div>

  <div class="history">
    <h2>交易紀錄</h2>
    <table>
      <thead>
        <tr>
          <th>時間</th>
          <th>動作</th>
          <th>股票</th>
          <th>數量</th>
          <th>單價</th>
        </tr>
      </thead>
      <tbody id="history-body"></tbody>
    </table>
  </div>

  <script>
    let stocks = [
      { name: "台積電", code: "2330", price: 600 },
      { name: "鴻海", code: "2317", price: 110 },
      { name: "聯發科", code: "2454", price: 900 },
      { name: "中華電", code: "2412", price: 120 },
      { name: "長榮", code: "2603", price: 150 },
      { name: "台達電", code: "2308", price: 280 }
    ];

    let cash = localStorage.getItem('cash') ? parseFloat(localStorage.getItem('cash')) : 100000;
    let portfolio = localStorage.getItem('portfolio') ? JSON.parse(localStorage.getItem('portfolio')) : {};
    let history = localStorage.getItem('history') ? JSON.parse(localStorage.getItem('history')) : [];

    function saveData() {
      localStorage.setItem('cash', cash);
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      localStorage.setItem('history', JSON.stringify(history));
    }

    function updateDisplay() {
      document.getElementById('cash').innerText = Math.floor(cash);
      const list = document.getElementById('stock-list');
      list.innerHTML = '';
      stocks.forEach(stock => {
        if (stock.visible) {
          const owned = portfolio[stock.code] || 0;
          const div = document.createElement('div');
          div.className = 'stock-item';
          div.innerHTML = `
            <div>
              <strong>${stock.name} (${stock.code})</strong><br>
              現價：${Math.floor(stock.price)} 元<br>
              持有：${owned} 股
            </div>
            <div>
              <input type="number" id="amount-${stock.code}" min="1" value="1">
              <button onclick="buyStock('${stock.code}')">買</button>
              <button onclick="sellStock('${stock.code}')">賣</button>
            </div>
          `;
          list.appendChild(div);
        }
      });
      updateHistory();
    }

    function buyStock(code) {
      const stock = stocks.find(s => s.code === code);
      const amount = parseInt(document.getElementById(`amount-${code}`).value);
      const cost = stock.price * amount;
      if (cash >= cost) {
        cash -= cost;
        portfolio[code] = (portfolio[code] || 0) + amount;
        history.unshift({ time: new Date().toLocaleString(), action: '買進', stock: stock.name, amount: amount, price: Math.floor(stock.price) });
        saveData();
        updateDisplay();
      } else {
        alert('資金不足！');
      }
    }

    function sellStock(code) {
      const stock = stocks.find(s => s.code === code);
      const amount = parseInt(document.getElementById(`amount-${code}`).value);
      if ((portfolio[code] || 0) >= amount) {
        cash += stock.price * amount;
        portfolio[code] -= amount;
        history.unshift({ time: new Date().toLocaleString(), action: '賣出', stock: stock.name, amount: amount, price: Math.floor(stock.price) });
        saveData();
        updateDisplay();
      } else {
        alert('持股不足！');
      }
    }

    function updateHistory() {
      const historyBody = document.getElementById('history-body');
      historyBody.innerHTML = '';
      history.forEach(record => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${record.time}</td>
          <td>${record.action}</td>
          <td>${record.stock}</td>
          <td>${record.amount}</td>
          <td>${record.price}</td>
        `;
        historyBody.appendChild(tr);
      });
    }

    function fluctuatePrices() {
      stocks.forEach(stock => {
        let change = (Math.random() - 0.5) * 10;
        stock.price += change;
        if (stock.price < 1) stock.price = 1;
      });
      updateDisplay();
    }

    function searchStock() {
      const input = document.getElementById('searchInput').value.trim();
      stocks.forEach(stock => {
        stock.visible = stock.name.includes(input) || stock.code.includes(input) || input === '';
      });
      updateDisplay();
    }

    stocks.forEach(stock => stock.visible = true);
    updateDisplay();
    setInterval(fluctuatePrices, 5000);
  </script>
</body>
</html>
